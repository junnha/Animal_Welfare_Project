# 1분 단위로 데이터 생성
# timestamp를 다시 인덱스로 설정
if 'timestamp' in df.columns:
    df.set_index('timestamp', inplace=True)

# 가장 빈번하게 등장한 상태(Mode)를 찾는 함수
def get_most_frequent(x):
    if len(x) == 0: return None
    return x.mode()[0] # 최빈값 선택

# 1분 동안 가장 많이 한 행동을 대표로 설정
df_resampled = df.resample('1min').agg({
    'state': get_most_frequent,  # 행동 상태는 최빈값
    'acc_magnitude': 'mean'      # 가속도는 평균값
}).dropna()

# 다시 타임스탬프를 컬럼으로 꺼냄
df_resampled = df_resampled.reset_index()

# 상태가 변하는 지점마다 그룹 ID 부여
df_resampled['group_id'] = (df_resampled['state'] != df_resampled['state'].shift()).cumsum()

# 요약표 만들기
summary_df = df_resampled.groupby('group_id').agg({
    'timestamp': ['min', 'max'],    # 시작 시간, 끝 시간
    'state': 'first',               # 상태 이름
    'acc_magnitude': 'count'        # 개수 세기
})

summary_df.columns = ['start_time', 'end_time', 'activity', 'duration_min']

print("시간대별 요약 데이터")
print(summary_df.to_string())
